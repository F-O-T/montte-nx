---
import { Github } from "@lucide/astro";
import type { SupportedLng } from "@packages/localization";
import { Button } from "@packages/ui/components/button";
import {
   fetchGitHubContributors,
   fetchGitHubRepoStats,
} from "@/services/github";

interface Props {
   lang?: SupportedLng;
}

const { lang: _lang = "pt-BR" } = Astro.props;

const contributors = await fetchGitHubContributors(10);
const githubStats = await fetchGitHubRepoStats();

const avatarPositions = [
   { left: "left-1", size: "size-20", top: "top-1" },
   { left: "right-2/5", size: "size-16", top: "top-7" },
   { left: "left-1/4", size: "size-18", top: "top-1/4" },
   { left: "right-8", size: "size-15", top: "top-20" },
   { left: "left-1", size: "size-16", top: "top-3/7" },
   { left: "right-0", size: "size-20", top: "top-1/2" },
   { left: "left-1/2", size: "size-16", top: "top-3/7" },
   { left: "left-1/4", size: "size-15", top: "top-3/5" },
   { left: "left-4", size: "size-20", top: "bottom-0" },
   { left: "left-1/2", size: "size-25", top: "bottom-0" },
];
---

<section id="contributors" class=" py-8 sm:py-16 lg:py-24">
   <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between gap-12 max-lg:flex-col md:gap-16 lg:gap-24">
         <div class="max-w-xl space-y-4 self-start">
            <h2 class="text-2xl font-semibold md:text-3xl lg:text-4xl">
               Conheca os Contribuidores do Projeto
            </h2>
            <p class="text-muted-foreground text-xl">
               Uma comunidade de desenvolvedores apaixonados que trabalham juntos para criar uma ferramenta financeira 
               transparente, acessivel e poderosa. Agradecemos a cada contribuicao!
            </p>
            <a
               href={`${githubStats.html_url}/graphs/contributors`}
               target="_blank"
               rel="noopener noreferrer"
            >
               <Button size="lg" className="rounded-lg text-base">
                  <Github class="size-4 mr-2"/>
                  Seja um Contribuidor
               </Button>
            </a>
         </div>

         <div class="relative h-108 w-100 max-lg:hidden">
            {contributors.slice(0, 10).map((contributor, index) => {
               const pos = avatarPositions[index] ?? avatarPositions[0]!;
               return (
                  <div 
                     class={`absolute ${pos.top} ${pos.left} max-sm:left-6`}
                     style={`transform: scale(${1 + Math.random() * 0.1})`}
                  >
                     <a
                        href={contributor.html_url}
                        target="_blank"
                        rel="noopener noreferrer"
                        title={`${contributor.login} - ${contributor.contributions} contribuicoes`}
                        class="block transition-transform hover:scale-110"
                     >
                        <img
                           src={contributor.avatar_url}
                           alt={contributor.login}
                           class={`rounded-full object-cover ${pos.size} ring-2 ring-background shadow-lg`}
                           loading="lazy"
                        />
                     </a>
                  </div>
               );
            })}
         </div>

         <div class="grid grid-cols-5 gap-4 lg:hidden">
            {contributors.slice(0, 10).map((contributor) => (
               <a
                  href={contributor.html_url}
                  target="_blank"
                  rel="noopener noreferrer"
                  title={`${contributor.login} - ${contributor.contributions} contribuicoes`}
                  class="block transition-transform hover:scale-110"
               >
                  <img
                     src={contributor.avatar_url}
                     alt={contributor.login}
                     class="rounded-full object-cover size-14 sm:size-16 ring-2 ring-background shadow-lg"
                     loading="lazy"
                  />
               </a>
            ))}
         </div>
      </div>
   </div>
</section>
