---
import { Code, GitFork, Heart, Star } from "@lucide/astro";
import type { SupportedLng } from "@packages/localization";
import { Button } from "@packages/ui/components/button";
import { fetchGitHubRepoStats } from "@/services/github";

interface Props {
   lang?: SupportedLng;
}

const { lang: _lang = "pt-BR" } = Astro.props;

const githubStats = await fetchGitHubRepoStats();

const stats = [
   {
      description: "Estrelas no GitHub",
      icon: Star,
      title: `${githubStats.stargazers_count}+ Stars`,
   },
   {
      description: "Forks do projeto",
      icon: GitFork,
      title: `${githubStats.forks_count}+ Forks`,
   },
   {
      description: "Codigo 100% aberto",
      icon: Code,
      title: "Open Source",
   },
   {
      description: "Gratis para sempre",
      icon: Heart,
      title: "100% Free",
   },
];
---

<section id="open-source" class="bg-muted py-8 sm:py-16 lg:py-24">
   <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="mb-24 flex items-center justify-between gap-16 max-md:flex-col">
         <div class="max-w-5xl space-y-4">
            <p class="text-primary text-sm font-medium uppercase">Open Source</p>
            <h2 class="text-xl font-semibold md:text-3xl lg:text-4xl">
               Transparencia e Liberdade no Controle Financeiro
            </h2>
            <p class="text-muted-foreground text-xl">
               O Montte e um projeto de codigo aberto. Acreditamos que ferramentas financeiras devem ser transparentes, 
               acessiveis e construidas pela comunidade. Contribua, sugira melhorias ou simplesmente use - voce esta no controle.
            </p>
         </div>
         <a
            href={githubStats.html_url}
            target="_blank"
            rel="noopener noreferrer"
         >
            <Button size="lg" className="rounded-lg text-base max-lg:self-center">
               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="size-4 mr-2"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
               Ver no GitHub
            </Button>
         </a>
      </div>

      <div class="grid gap-16 lg:grid-cols-2">
         <div class="relative flex h-max justify-center">
            <svg width="191" height="159" class="text-primary absolute -top-14 -left-7 opacity-30 sm:-left-3 md:-top-4 md:left-10 lg:-top-3 lg:-left-4" viewBox="0 0 191 159" fill="none" xmlns="http://www.w3.org/2000/svg">
               <path d="M161.576 24.5939L137.902 24.5938H88.9971C68.8234 25.4582 28.5105 39.2264 28.6488 87.3839C28.7871 135.541 28.7064 131.37 28.6488 133.878" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="3 3"/>
               <path opacity="0.5" d="M174.806 13.3049L143.576 13.3047H86.2089C62.5444 14.3187 15.2561 30.4693 15.4184 86.9595C15.5807 143.45 15.486 142.23 15.4184 145.172" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="3 3"/>
               <path opacity="0.2" d="M189.224 1.00026L149.759 1H83.1702C55.7018 2.17701 0.812128 20.9237 1.00048 86.4945C1.18884 152.065 1.07896 154.061 1.00048 157.476" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="3 3"/>
            </svg>

            <div class="z-10 w-5/6 max-md:scale-110 md:p-6 lg:w-full">
               <div class="bg-card border rounded-2xl shadow-lg p-8 relative overflow-hidden">
                  <div class="absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full -translate-y-1/2 translate-x-1/2"></div>
                  <div class="absolute bottom-0 left-0 w-24 h-24 bg-primary/5 rounded-full translate-y-1/2 -translate-x-1/2"></div>
                  
                  <div class="relative">
                     <div class="flex items-center gap-4 mb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="size-12 text-foreground"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                        <div>
                           <p class="text-2xl font-bold">{githubStats.full_name}</p>
                           <p class="text-muted-foreground">Repositorio Oficial</p>
                        </div>
                     </div>
                     
                     <div class="bg-muted/50 rounded-lg p-4 font-mono text-sm mb-6">
                        <p class="text-muted-foreground mb-2"># Clone o repositorio</p>
                        <p class="text-foreground">git clone https://github.com/{githubStats.full_name}.git</p>
                     </div>

                     <div class="flex items-center gap-6 text-sm">
                        <div class="flex items-center gap-2">
                           <Star class="size-4 text-yellow-500"/>
                           <span class="font-medium">{githubStats.stargazers_count} stars</span>
                        </div>
                        <div class="flex items-center gap-2">
                           <GitFork class="size-4 text-primary"/>
                           <span class="font-medium">{githubStats.forks_count} forks</span>
                        </div>
                        <div class="flex items-center gap-2">
                           <Code class="size-4 text-muted-foreground"/>
                           <span class="font-medium">TypeScript</span>
                        </div>
                     </div>
                  </div>
               </div>
            </div>

            <div class="absolute bottom-5 left-12 grid grid-cols-7 gap-1 opacity-50 sm:bottom-11 sm:left-22 md:bottom-22 md:left-38 lg:bottom-36 lg:left-35 xl:bottom-21 xl:left-21">
               {Array.from({ length: 49 }).map(() => (
                  <div class="bg-primary/50 size-1 rounded-full"/>
               ))}
            </div>

            <div class="absolute right-2.5 -bottom-7 grid grid-cols-7 gap-1 opacity-50 sm:right-6 sm:-bottom-11 md:right-21 md:bottom-1 lg:right-7">
               {Array.from({ length: 49 }).map(() => (
                  <div class="bg-primary/50 size-1 rounded-full"/>
               ))}
            </div>
         </div>

         <div class="grid gap-6 sm:grid-cols-2">
            {stats.map((stat) => (
               <div class="bg-card text-card-foreground flex flex-col gap-6 rounded-xl border-none py-6 shadow-none transition-shadow duration-300 hover:shadow-sm">
                  <div class="px-6 flex h-full flex-col items-center justify-center text-center">
                     <div class="border-primary mb-6 flex size-11.5 items-center justify-center rounded-md border">
                        <stat.icon class="size-5"/>
                     </div>
                     <div class="font-semibold mb-2 text-xl">{stat.title}</div>
                     <p class="text-muted-foreground">{stat.description}</p>
                  </div>
               </div>
            ))}
         </div>
      </div>
   </div>
</section>
