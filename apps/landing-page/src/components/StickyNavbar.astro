---
import type { SupportedLng } from "@packages/localization";
import { translate } from "@packages/localization";
import { Button } from "@packages/ui/components/button";
import Logo from "./Logo.astro";
import { MobileMenu } from "./mobile-menu";
import { NavMenu } from "./nav-menu";
import ThemeToggler from "./ThemeToggler.astro";

interface Props {
   lang?: SupportedLng;
}

const { lang = "pt-BR" } = Astro.props;
const brandName = translate("common.brand.name", { lng: lang });
---

<nav
   id="sticky-navbar"
   class="fixed top-0 inset-x-0 h-16 bg-background/80 backdrop-blur-md border-b dark:border-slate-700/70 z-50 shadow-sm shadow-black/5 dark:shadow-black/20"
>
   <div class="h-full flex items-center justify-between max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div
         class="flex items-center gap-3 transition-transform duration-300 hover:scale-105"
      >
         <Logo size={32} class="text-primary"/>
         <span class="text-xl font-bold text-foreground hidden sm:block">
            {brandName}
         </span>
      </div>

      <div class="hidden md:block">
         <NavMenu lang={lang} client:load/>
      </div>

      <div class="flex items-center gap-3">
         <div class="transition-transform duration-300 hover:scale-110">
            <ThemeToggler/>
         </div>

         <Button className="hidden md:block">
            <a
               href="https://app.montte.co/auth/sign-in"
               target="_blank"
               rel="noopener noreferrer"
               class="no-underline text-white"
            >
               Come√ßar
            </a>
         </Button>

         <div
            class="md:hidden transition-transform duration-300 hover:scale-110"
         >
            <MobileMenu lang={lang} client:load/>
         </div>
      </div>
   </div>
</nav>



<style>
   @supports (backdrop-filter: blur(12px)) {
      #sticky-navbar {
         backdrop-filter: blur(12px) saturate(150%);
      }

      :global(.dark) #sticky-navbar {
         border-color: rgba(255, 255, 255, 0.1);
      }
   }
</style>

<script>
   function initStickyNavbar() {
      const stickyNavbar = document.getElementById("sticky-navbar");

      if (!stickyNavbar) return;

      const addSmoothScrolling = () => {
         const navLinks = stickyNavbar.querySelectorAll('a[href^="#"]');
         navLinks.forEach((link) => {
            link.addEventListener("click", (e) => {
               const href = link.getAttribute("href");
               if (href && href.startsWith("#")) {
                  const target = document.querySelector(href);
                  if (target) {
                     e.preventDefault();
                     target.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                     });
                  }
               }
            });
         });
      };

      addSmoothScrolling();
   }

   if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initStickyNavbar);
   } else {
      initStickyNavbar();
   }
</script>
